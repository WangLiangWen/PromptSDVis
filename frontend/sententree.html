<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>左至右节点布局示例</title>
    <style>
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 2px;
        }

        .text {
            font-family: sans-serif;
            font-size: 12px;
            text-anchor: middle; /* 水平居中 */
            dominant-baseline: central; /* 垂直居中 */
        }

        .text-bg {
            fill: #f0f0f0; /* 灰色背景 */
        }
    </style>
</head>

<body>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const width = 800, height = 400;
        const nodeSpacing = 150; // 节点之间的间距
        const startX = 100; // 起始X坐标
        const centerY = height / 2; // Y坐标保持居中

        const svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        let dataset = {
            nodes: [
                { id: 0, name: "Prompt Adddddd" },
                { id: 1, name: "Prompt B" },
                { id: 2, name: "Prompt C" },
                { id: 3, name: "Prompt D" }
            ],
            links: [
                { source: 0, target: 1 },
                { source: 1, target: 2 },
                { source: 2, target: 3 }
            ]
        };

        // 计算节点的左至右布局位置
        dataset.nodes.forEach((node, i) => {
            node.x = startX + i * nodeSpacing; // 计算每个节点的x坐标
            node.y = centerY; // y坐标固定在中心
        });

        // 绘制连线
        const link = svg.selectAll(".link")
            .data(dataset.links)
            .enter().append("line")
            .attr("class", "link")
            .attr("x1", d => dataset.nodes[d.source].x)
            .attr("y1", d => dataset.nodes[d.source].y)
            .attr("x2", d => dataset.nodes[d.target].x)
            .attr("y2", d => dataset.nodes[d.target].y)
            .style("stroke", "#ccc")
            .style("stroke-width", 2);

        // 绘制文本背景
        const textBackground = svg.selectAll(".text-bg")
            .data(dataset.nodes)
            .enter().append("rect")
            .attr("class", "text-bg");

        // 添加节点标签
        const text = svg.selectAll(".text")
            .data(dataset.nodes)
            .enter().append("text")
            .attr("class", "text")
            .attr("x", d => d.x)
            .attr("y", d => d.y)
            .text(d => d.name)
            .each(function(d) {
                const bbox = this.getBBox();
                d.bbox = bbox;
            });

        // 更新文本背景位置和大小
        textBackground
            .attr("x", d => d.bbox.x - 5)
            .attr("y", d => d.bbox.y - 2)
            .attr("width", d => d.bbox.width + 10)
            .attr("height", d => d.bbox.height + 4)
            .attr("fill", "#f0f0f0");
    </script>
</body>

</html>
